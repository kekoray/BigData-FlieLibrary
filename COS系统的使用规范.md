# COS系统的使用规范

> Author:  koray
>
> Version:  1.0 (持续更新完善)
>
> Date:  2020-11-20







## 1. COS目录命名规范



#### **命名格式 **

- ==**Cos桶名+公共目录名(项目名_公共功能)+数据层级名+留存时间标识+表名**==

> 示例  :  cosn://emr-1254463213/lazada_dw/ods/ods_mysql_station/





#### 1. Cos桶命名

- 大数据平台的Cos桶名称 ：**emr** 
- 爬虫数据的Cos桶名称 ：**spider_log**





#### 2. 公共目录名

**项目名**

- 目前项目有 **lazada  、shopee** 

| 项目       | 示例                  |
| :--------- | --------------------- |
| **lazada** | cosn://emr/lazada_dw/ |
| **shopee** | cosn://emr/shopee_dw/ |



**公共功能**

| 功能                     | 标识               | 示例                       |
| ------------------------ | ------------------ | -------------------------- |
| hive数仓(data warehouse) | **dw**             | cosn://emr/lazada_dw/      |
| 数据导出的缓存层         | **bigdata_export** | cosn://emr/bigdata_export/ |





#### 3. 数据层级名

| 数仓层级 | 说明                                            | 示例                      |
| -------- | ----------------------------------------------- | ------------------------- |
| ods层    | 数据贴源层，映射cos的原始数据                   | cosn://emr/lazada_dw/ods/ |
| dwd层    | 数据明细层，对ods层进行ETL处理从而得出基础表    | cosn://emr/lazada_dw/dwd/ |
| app层    | 数据应用层，聚合分析dwd层的数据，供后续业务使用 | cosn://emr/lazada_dw/app/ |





#### 4. 留存时间标识

> 暂时不启用

| 留存时间                     | 标识            |
| ---------------------------- | --------------- |
| 长期保存(不删除)             | **long_term**   |
| 保留1年                      | **one_year**    |
| 保留近半年(180天)            | **half_year**   |
| 保留近30天                   | **thirty_days** |
| 保留近7天                    | **seven_days**  |
| 保留一天                     | **one_day**     |
| 脚本中设置的维护数据任务目录 | **others**      |





#### 5. 表名

- **本文档要求表名与数据存储路径最后一个名字一致，原始日志表(ods)除外。**
  - Cos存储路径  :  cosn://emr-1254463213/lazada_dw/ods/ods_mysql_station/
  - 表名为  :  ods_mysql_station
- *表的命名规范详见大数据开发规范文档*







## 2.日志服务的COS投递设置



##### 基本配置

| 配置项       | 参数                                                         | 例子                                                         |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| COS存储桶    | **COS桶名 **                                                 | spider-log-1254463213                                        |
| 目录前缀     | **项目\_主题\_csv**                                          | lzd_item_csv/                                                |
| 分区格式     | **%Y-%m-%d/%H/主题**                                         | %Y-%m-%d/%H/item  (hive表分区字段格式yyyy-MM-dd)             |
| 路径         | **{COS存储桶}{目录前缀}{分区格式}**_{random}\_{index}.{type} | cosn://spider-log-1254463213.cos.ap-shanghai.myqcloud.com/==**lzd_item_csv/2020-11-09/10/item**==_2f25fd1d-b34d-4de6-b3bf-e8a754a85fb1_000 |
| 压缩         | 无                                                           |                                                              |
| 投递文件大小 | 100M                                                         |                                                              |
| 投递间隔时间 | 5min                                                         |                                                              |



##### 高级设置

| 配置项   | 参数        |
| -------- | ----------- |
| 投递格式 | **csv**     |
| 键值索引 | **content** |
| 分隔符   | **制表符**  |
| 转义符   | **空**      |
